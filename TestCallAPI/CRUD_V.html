<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å¿—å·¥è³‡è¨Š CRUD æ¸¬è©¦</title>
</head>
<body>
  <h1>å¿—å·¥è³‡è¨Šç®¡ç†</h1>

  <h2>â• æ–°å¢å¿—å·¥</h2>
  <form id="addForm">
    <input type="text" id="volunteer_name" placeholder="å§“å" required />
    <input type="text" id="gender" placeholder="æ€§åˆ¥" required />
    <input type="number" id="age" placeholder="å¹´é½¡" />
    <input type="text" id="personality" placeholder="æ€§æ ¼" />
    <input type="text" id="available_time" placeholder="ç©ºé–’æ™‚é–“" />
    <button type="submit">æ–°å¢</button>
  </form>

  <h2>ğŸ“‹ å¿—å·¥åˆ—è¡¨</h2>
  <div id="volunteer"></div>

  <script>
    const apiUrl = "https://supabase-api-six.vercel.app/volunteers";

    // ğŸ”¹ è®€å–å¿—å·¥è³‡æ–™
    async function loadVolunteers() {
      const container = document.getElementById("volunteer");
      container.innerHTML = "è®€å–ä¸­...";
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();

        container.innerHTML = data.data.map(v => `
          <div style="border:1px solid #ccc; padding:10px; margin:5px;">
            <p><strong>å§“åï¼š</strong> ${v.volunteer_name}</p>
            <p><strong>æ€§åˆ¥ï¼š</strong> ${v.gender}</p>
            <p><strong>å¹´é½¡ï¼š</strong> ${v.age}</p>
            <p><strong>å°ˆé•·ï¼š</strong> ${v.personality}</p>
            <p><strong>ç©ºé–’æ™‚é–“ï¼š</strong> ${v.available_time}</p>
            <button onclick="deleteVolunteer('${v.volunteer_user_id}')">åˆªé™¤</button>
            <button onclick="updateVolunteer('${v.volunteer_user_id}')">æ›´æ–°</button>
          </div>
        `).join("");
      } catch (err) {
        console.error(err);
        container.innerText = "âŒ ç„¡æ³•å–å¾—å¿—å·¥è³‡æ–™";
      }
    }

    // ğŸ”¹ æ–°å¢å¿—å·¥
    document.getElementById("addForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const newVolunteer = {
        volunteer_name: document.getElementById("volunteer_name").value,
        gender: document.getElementById("gender").value,
        age: parseInt(document.getElementById("age").value) || null,
        personality: document.getElementById("personality").value,
        available_time: document.getElementById("available_time").value,
        volunteer_user_id: "test_line_id_" + Math.random().toString(36).slice(2, 8) // å‡è³‡æ–™
      };

      try {
        const res = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(newVolunteer)
        });
        if (!res.ok) throw new Error("æ–°å¢å¤±æ•—");
        alert("âœ… æ–°å¢æˆåŠŸï¼");
        loadVolunteers();
        e.target.reset();
      } catch (err) {
        alert("âŒ æ–°å¢å¤±æ•—ï¼š" + err.message);
      }
    });

    // ğŸ”¹ åˆªé™¤å¿—å·¥
    async function deleteVolunteer(id) {
      if (!confirm("ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ")) return;
      try {
        const res = await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
        if (!res.ok) throw new Error("åˆªé™¤å¤±æ•—");
        alert("ğŸ—‘ï¸ åˆªé™¤æˆåŠŸï¼");
        loadVolunteers();
      } catch (err) {
        alert("âŒ åˆªé™¤å¤±æ•—ï¼š" + err.message);
      }
    }

    // ğŸ”¹ æ›´æ–°å¿—å·¥ï¼ˆç¤ºç¯„ä¿®æ”¹å¹´é½¡ï¼‰
    async function updateVolunteer(id) {
      const newAge = prompt("è«‹è¼¸å…¥æ–°çš„å¹´é½¡ï¼š");
      if (!newAge) return;
      try {
        const res = await fetch(`${apiUrl}/${id}`, {
          method: "PATCH",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ age: parseInt(newAge) })
        });
        if (!res.ok) throw new Error("æ›´æ–°å¤±æ•—");
        alert("âœ… æ›´æ–°æˆåŠŸï¼");
        loadVolunteers();
      } catch (err) {
        alert("âŒ æ›´æ–°å¤±æ•—ï¼š" + err.message);
      }
    }

    // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
    loadVolunteers();
  </script>
</body>
</html>
